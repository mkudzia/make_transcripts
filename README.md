## Introduction ##
This is a module that works with [audiogrep](https://github.com/antiboredom/audiogrep) to create timestamped transcripts of audio files. It is very experimental and in the early stages of development.

## Installation ##

This script also assumes you're getting a transcript from [audiogrep](https://github.com/antiboredom/audiogrep), so first you need to install that. 

Audiogrep requires [pip](https://pip.pypa.io/en/stable/installing/), [ffmpeg](http://ffmpeg.org/), and [pocketsphinx](http://cmusphinx.sourceforge.net/). DISCLAIMER: the audiogrep [installation instructions](https://github.com/antiboredom/audiogrep/blob/master/README.md) in general assume you're using a mac. 

You'll need [Python 3](https://www.python.org/downloads/) and [lxml](http://lxml.de/installation.html) to run this script (see lxml install instructions in the next paragraph). If you have Python 2.x installed on your machine, you can also install Python 3 to run alongside it; there are lots of instructions on the internet about how to do this. Because instructions vary depending on what OS you're using, use Google and your judgement to decide which instructions to use. 

To use this script (assuming 2.x is your primary version of Python), use the command ```python3``` rather than ```python```. Likewise, to install lxml, try typing ```python3 -m pip install lxml``` -- this should let you install lxml in a way that it will work with Python 3.

You should be all set to create transcripts at this point.

## Creating Transcripts ##

Once you have audiogrep and its dependencies installed, you'll follow several steps to create plain text of the transcript, as well as some structured XML that the Islandora Oral Histories module can use. 
* Assuming you don't have transcript files yet, use audiogrep to create the initial transcript files (per the audiogrep readme):

```
audiogrep --input path/to/*.mp3 --transcribe
```
This will transcribe all the audio files in a given directory. Budget some time for this; each transcript will take less than the total time of the audio recording, but could take up to half as long. In general, if you have lots of audio files, expect that this step will be lengthy.
* To transcribe one file at a time, use ```cd``` to get to the folder containing the audio files, and then:

```
audiogrep --input filename.mp3 --transcribe
```
where "filename" is the name of the file you want to transcribe.
* Download make_transcripts and then copy the folder with you mp3s into ```make_transcripts/transcription```
* Open ```transcript_parsing.py``` in your preferred text editor and change the ```path``` variable (on line 13) that says "path/to/your/mp3s" to the actual filepath you'll be using
* Navigate to ```transcription``` using the command line and then type ``python3 transcript_parsing.py```

You should get derivative folders for each audio recording, containing:
* a copy of the mp3 audio file
* a copy of the transcription.txt file generated by audiogrep
* a derivative .txt file with timestamp information (no chunks of text)
* a derivative .txt file with just text
* a derivative .xml file with timestamp information
* a structured XML document (filename_transcript.xml) for use with the Islandora Oral Histories module
* a VTT caption file (filename_vtt.txt) for use with the Islandora Oral Histories module

## Use with Islandora ##
The XML transcript output is intended to fit the [Islandora Oral Histories Module](https://github.com/digitalutsc/islandora_solution_pack_oralhistories).
The Oral Histories Module has the following dependencies (per their github page): 
* [Islandora](https://github.com/islandora/islandora)
* [Tuque](https://github.com/islandora/tuque) 
* [Islandora Solr Search](https://github.com/Islandora/islandora_solr_search)
* [Islandora Video Solution Pack](https://github.com/Islandora/islandora_solution_pack_video)
* [Islandora Audio Solution Pack](https://github.com/Islandora/islandora_solution_pack_audio)
* [Transcripts UI](https://github.com/Islandora/islandora_solution_pack_audio)

Once you've created the derivatives: 
* Navigate to ingestd3.lib.msu.edu 
* Choose the relevant collection name from the "Ingest" drop-down menu
* Enter the namespace (use the collection name and a semi-colon; see individual collection docs for details)
* Choose the relevant folder containing derivatives for ingest using the "path to ingest" drop-down
* If desired, choose the "ingest only new" or "replace metadata" option
* Click the "submit" button
* You should see a message telling you your job has been submitted 
   * If you click the button to see your job, wait a moment and then re-load the screen to see the true status of your job (it takes a moment to get started)
